<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>íšŒì› ìš´ë™ ê¸°ë¡ ì‹œìŠ¤í…œ</title>
  <style>
    body {
      font-family: Arial, "ë§‘ì€ ê³ ë”•", sans-serif;
      max-width: 1100px;
      margin: 20px auto;
      background: #f3f4f6;
      color: #111827;
    }
    h1 {
      margin-bottom: 10px;
      font-size: 24px;
      color: #111827;
    }
    h2 {
      margin-top: 30px;
      font-size: 20px;
      color: #111827;
    }
    h4 {
      margin: 8px 0;
    }
    .box {
      border: 1px solid #e5e7eb;
      padding: 12px 16px;
      margin-bottom: 12px;
      border-radius: 8px;
      background: #ffffff;
      box-shadow: 0 1px 2px rgba(0,0,0,0.03);
    }
    label {
      display: inline-block;
      margin: 5px 10px 5px 0;
      font-size: 13px;
    }
    input[type="text"], select, input[type="number"], input[type="date"], input[type="file"] {
      padding: 5px 8px;
      border-radius: 4px;
      border: 1px solid #d1d5db;
      font-size: 13px;
    }
    input[type="text"]:focus,
    input[type="number"]:focus,
    input[type="date"]:focus,
    select:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37,99,235,0.2);
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 8px;
      background: #fff;
    }
    th, td {
      border: 1px solid #e5e7eb;
      padding: 5px;
      text-align: center;
      font-size: 12px;
    }
    th {
      background: #f9fafb;
      font-weight: 600;
    }
    button {
      padding: 6px 12px;
      margin: 4px 4px 4px 0;
      cursor: pointer;
      font-size: 13px;
      border-radius: 4px;
      border: none;
      font-weight: 500;
    }
    .btn-primary { background: #2563eb; color: #ffffff; }
    .btn-primary:hover { background: #1d4ed8; }

    .btn-success { background: #16a34a; color: #ffffff; }
    .btn-success:hover { background: #15803d; }

    .btn-warning { background: #f97316; color: #ffffff; }
    .btn-warning:hover { background: #ea580c; }

    .btn-danger { background: #dc2626; color: #ffffff; }
    .btn-danger:hover { background: #b91c1c; }

    .btn-gray { background: #6b7280; color: #ffffff; }
    .btn-gray:hover { background: #4b5563; }

    .btn-purple { background: #7c3aed; color: #ffffff; }
    .btn-purple:hover { background: #6d28d9; }

    .set-row input {
      width: 80px;
      text-align: center;
    }
    .small { font-size: 11px; color: #6b7280; }
    .tag {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 11px;
      background: #e5e7eb;
      margin-right: 4px;
      margin-bottom: 2px;
    }
    .last-hint {
      font-size: 11px;
      color: #374151;
      margin-top: 4px;
      min-height: 14px;
    }
    .member-tag-mini {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      background: #e0f2fe;
      font-size: 11px;
      margin-right: 4px;
      margin-bottom: 4px;
    }
    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
      color: #111827;
    }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    .modal-content {
      background: #ffffff;
      padding: 16px;
      border-radius: 8px;
      max-width: 900px;
      max-height: 80vh;
      overflow: auto;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    /* ëŒ€ì‹œë³´ë“œ ìŠ¤íƒ€ì¼ */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 8px;
      margin-top: 6px;
      margin-bottom: 6px;
    }
    .dashboard-card {
      border-radius: 8px;
      padding: 8px 10px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      font-size: 12px;
    }
    .dashboard-card strong {
      font-size: 13px;
    }
    .volume-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
      font-size: 11px;
    }
    .volume-bar-container {
      flex: 1;
      background: #e5e7eb;
      border-radius: 999px;
      overflow: hidden;
      height: 8px;
    }
    .volume-bar {
      height: 8px;
      border-radius: 999px;
      background: #2563eb;
    }

    @media print {
      body { background: #ffffff; }
      body * { visibility: hidden; }
      #groupPrintArea, #groupPrintArea * {
        visibility: visible;
      }
      #groupPrintArea {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <h1>íšŒì› ìš´ë™ ê¸°ë¡ ì‹œìŠ¤í…œ</h1>

  <!-- 0. íšŒì› ë“±ë¡ / ê´€ë¦¬ -->
  <div class="box">
    <div class="section-title">0. íšŒì› ë“±ë¡ / ê´€ë¦¬</div>
    <div style="margin-bottom:6px;">
      <label>ì´ë¦„:
        <input type="text" id="regName" placeholder="ì˜ˆ: í™ê¸¸ë™" />
      </label>
      <label>ì„±ë³„:
        <select id="regGender">
          <option value="">ì„ íƒ</option>
          <option value="ë‚¨">ë‚¨</option>
          <option value="ì—¬">ì—¬</option>
        </select>
      </label>
      <label>í‚¤(cm):
        <input type="number" id="regHeight" placeholder="ì˜ˆ: 170" />
      </label>
      <label>ìƒë…„ì›”ì¼:
        <input type="date" id="regBirth" />
      </label>
      <label>ì „í™”ë²ˆí˜¸:
        <input type="text" id="regPhone" placeholder="ì˜ˆ: 010-1234-5678" />
      </label>
      <button id="registerMemberBtn" class="btn-primary">íšŒì› ë“±ë¡</button>
      <span class="small">â€» ì´ë¦„/ì„±ë³„/í‚¤/ìƒë…„ì›”ì¼/ì „í™”ë²ˆí˜¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.</span>
    </div>
    <button id="openMembersModalBtn" class="btn-gray">ì „ì²´ íšŒì› ëª©ë¡ ë³´ê¸°</button>
    <span class="small">â€» íšŒì› ìˆ˜ê°€ ë§ì•„ë„ í™”ë©´ì´ ê¸¸ì–´ì§€ì§€ ì•Šë„ë¡ ë³„ë„ ì°½ì—ì„œ í™•ì¸í•©ë‹ˆë‹¤.</span>
  </div>

  <!-- 1. ìš´ë™ ê¸°ë¡ ëŒ€ìƒ íšŒì› ì„ íƒ -->
  <div class="box">
    <div class="section-title">1. ìš´ë™ ê¸°ë¡ ëŒ€ìƒ íšŒì› ì„ íƒ</div>
    <label>íšŒì› ì„ íƒ:
      <select id="memberSelect">
        <option value="">íšŒì› ì„ íƒ</option>
      </select>
    </label>
    <label>íšŒì› ê²€ìƒ‰:
      <input type="text" id="memberSearchInput" placeholder="ì´ë¦„ ë˜ëŠ” ì „í™”ë²ˆí˜¸ ì¼ë¶€" />
    </label>
    <button id="memberSearchBtn" class="btn-primary">ë¶ˆëŸ¬ì˜¤ê¸°</button>
    <div id="selectedMemberInfo" class="small" style="margin-top:4px;">
      ì„ íƒëœ íšŒì› ì •ë³´: ì—†ìŒ
    </div>
  </div>

  <!-- 1-1. íšŒì› ëŒ€ì‹œë³´ë“œ (í™ˆ ìš”ì•½) -->
  <div class="box">
    <div class="section-title">1-1. íšŒì› ëŒ€ì‹œë³´ë“œ (ìš”ì•½)</div>
    <div id="dashboardSummary" class="small">
      1ë²ˆì—ì„œ íšŒì›ì„ ì„ íƒí•˜ë©´, ìš´ë™ëŸ‰/ê¸°ë¡/ì¸ë°”ë”” ì¶”ì´ë¥¼ í•œëˆˆì— ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    </div>
    <div id="dashboardVolume"></div>
    <div id="dashboardInbody"></div>
  </div>

  <!-- 2. í˜„ì¬ ìš´ë™ ì…ë ¥ -->
  <div class="box">
    <div class="section-title">2. í˜„ì¬ ìš´ë™ ì…ë ¥</div>
    <label>ìš´ë™ ë¶€ìœ„:
      <select id="bodyPart">
        <option value="">ì„ íƒ</option>
        <option value="ê°€ìŠ´">ê°€ìŠ´</option>
        <option value="ë“±">ë“±</option>
        <option value="í•˜ì²´">í•˜ì²´</option>
        <option value="ì–´ê¹¨">ì–´ê¹¨</option>
        <option value="íŒ”">íŒ”</option>
        <option value="ì „ì‹ ">ì „ì‹ </option>
        <option value="ì½”ì–´">ì½”ì–´</option>
        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
      </select>
    </label>
    <br/>
    <label>ìš´ë™ ëª…ì¹­:
      <input type="text" id="exerciseName" placeholder="ì˜ˆ: ë²¤ì¹˜í”„ë ˆìŠ¤ / ë«í’€ë‹¤ìš´" />
    </label>
    <label>ìš´ë™ ì„ íƒ:
      <select id="exercisePreset">
        <option value="">ë¶€ìœ„ ì„ íƒ í›„ ìš´ë™ ì„ íƒ</option>
      </select>
    </label>
    <div id="lastHint" class="last-hint"></div>

    <h4>ì„¸íŠ¸ë³„ ë¬´ê²Œ / íšŸìˆ˜</h4>
    <table>
      <thead>
        <tr>
          <th>ì„¸íŠ¸</th>
          <th>ë¬´ê²Œ(kg)</th>
          <th>íšŸìˆ˜(íšŒ)</th>
          <th>ì‚­ì œ</th>
        </tr>
      </thead>
      <tbody id="currentSetTbody"></tbody>
    </table>
    <button id="addSetBtn" class="btn-primary">ì„¸íŠ¸ ì¶”ê°€</button>
    <button id="resetSetsBtn" class="btn-gray">ì„¸íŠ¸ ì´ˆê¸°í™”</button>
    <br />
    <button id="addExerciseBtn" class="btn-success">í˜„ì¬ ìš´ë™ì„ ì˜¤ëŠ˜ ë£¨í‹´ì— ì¶”ê°€</button>
    <span class="small">â€» ì¶”ê°€ í›„ ë‹¤ìŒ ìš´ë™ì„ ì…ë ¥í•˜ì„¸ìš”.</span>
  </div>

  <!-- 2-1. ìš´ë™ ë“œëë‹¤ìš´ ê´€ë¦¬ -->
  <div class="box">
    <div class="section-title">2-1. ìš´ë™ ë“œëë‹¤ìš´ ê´€ë¦¬ (ì¶”ê°€ / ì‚­ì œ)</div>
    <label>ìš´ë™ ë¶€ìœ„:
      <select id="libBodyPart">
        <option value="">ì„ íƒ</option>
        <option value="ê°€ìŠ´">ê°€ìŠ´</option>
        <option value="ë“±">ë“±</option>
        <option value="í•˜ì²´">í•˜ì²´</option>
        <option value="ì–´ê¹¨">ì–´ê¹¨</option>
        <option value="íŒ”">íŒ”</option>
        <option value="ì „ì‹ ">ì „ì‹ </option>
        <option value="ì½”ì–´">ì½”ì–´</option>
        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
      </select>
    </label>
    <br/>
    <label>í˜„ì¬ ë“±ë¡ëœ ìš´ë™ ëª©ë¡:
      <select id="libExerciseList" size="5" style="min-width:220px;"></select>
    </label>
    <br/>
    <label>ìƒˆ ìš´ë™ëª…:
      <input type="text" id="libNewExercise" placeholder="ì˜ˆ: ìŠ¤ë¯¸ìŠ¤ ë°ë“œë¦¬í”„íŠ¸" />
    </label>
    <button id="libAddBtn" class="btn-primary">ìš´ë™ ì¶”ê°€</button>
    <button id="libDeleteBtn" class="btn-danger">ì„ íƒ ì‚­ì œ</button>
    <div class="small" style="margin-top:4px;">
      â€» ì—¬ê¸°ì„œ ì¶”ê°€/ì‚­ì œí•œ ìš´ë™ì€ 2ë²ˆ ì˜ì—­ì˜ â€œìš´ë™ ì„ íƒâ€ ë“œëë‹¤ìš´ì—ë„ ë°”ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.<br/>
      â€» ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì €ì— ì €ì¥ë˜ì–´, ë‹¤ìŒì— ì¼œë„ ìœ ì§€ë©ë‹ˆë‹¤(ê°™ì€ PCÂ·ë¸Œë¼ìš°ì € ê¸°ì¤€).
    </div>
  </div>

  <!-- 3. ì˜¤ëŠ˜ ë£¨í‹´ ëª©ë¡ -->
  <div class="box">
    <div class="section-title">3. ì˜¤ëŠ˜ ì¶”ê°€ëœ ìš´ë™ ëª©ë¡</div>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>ë¶€ìœ„</th>
          <th>ìš´ë™ëª…</th>
          <th>ì„¸íŠ¸ ìš”ì•½</th>
          <th>ì‚­ì œ</th>
        </tr>
      </thead>
      <tbody id="todayTbody"></tbody>
    </table>
    <button id="saveSessionBtn" class="btn-success">ì˜¤ëŠ˜ ìš´ë™ ì „ì²´ ì €ì¥</button>
    <span class="small">â€» ì„ íƒëœ íšŒì›ì˜ ì´ë¦„ìœ¼ë¡œ ì˜¤ëŠ˜ ìš´ë™ì´ ì €ì¥ë©ë‹ˆë‹¤.</span>
  </div>

  <!-- 8. í…ìŠ¤íŠ¸ë¡œ ìš´ë™ ê¸°ë¡ ì¼ê´„ ë“±ë¡ (ë¡œì»¬ ì „ìš©) -->
  <div class="box">
    <div class="section-title">8. í…ìŠ¤íŠ¸ë¡œ ìš´ë™ ê¸°ë¡ ì¼ê´„ ë“±ë¡ (ë¡œì»¬ ì „ìš©)</div>
    <span class="small">
      í•œ ì¤„ë‹¹ í•˜ë‚˜ì˜ ìš´ë™ì„ ì•„ë˜ í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•œ ë’¤,<br/>
      <b>[í…ìŠ¤íŠ¸ â†’ ì˜¤ëŠ˜ ë£¨í‹´ ë°˜ì˜]</b> ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ 3ë²ˆ â€œì˜¤ëŠ˜ ì¶”ê°€ëœ ìš´ë™ ëª©ë¡â€ì— ìë™ìœ¼ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.<br/>
      ì˜ˆì‹œ)<br/>
      ê°€ìŠ´ / ë²¤ì¹˜í”„ë ˆìŠ¤ / 60x10; 60x8; 50x12<br/>
      ë“± / ë«í’€ë‹¤ìš´ / 40x12; 40x10; 35x12
    </span>
    <textarea id="bulkTextInput" rows="6"
      style="width:100%; margin-top:6px; font-size:12px; font-family:monospace;"></textarea>
    <div style="margin-top:6px;">
      <button id="bulkTextApplyBtn" class="btn-success">í…ìŠ¤íŠ¸ â†’ ì˜¤ëŠ˜ ë£¨í‹´ ë°˜ì˜</button>
      <button id="bulkTextClearBtn" class="btn-gray">í…ìŠ¤íŠ¸ ì§€ìš°ê¸°</button>
    </div>
    <div class="small" style="margin-top:4px;">
      â€¢ í˜•ì‹: <b>ë¶€ìœ„ / ìš´ë™ëª… / ë¬´ê²ŒxíšŸìˆ˜; ë¬´ê²ŒxíšŸìˆ˜; â€¦</b><br/>
      â€¢ ë¶€ìœ„ëŠ” í˜„ì¬ ë“œëë‹¤ìš´ì— ìˆëŠ” ì´ë¦„(ê°€ìŠ´, ë“±, í•˜ì²´, ì–´ê¹¨, íŒ”, ì „ì‹ , ì½”ì–´, ê¸°íƒ€) ê¸°ì¤€ìœ¼ë¡œ ì¸ì‹í•©ë‹ˆë‹¤.<br/>
      â€¢ ìš´ë™ëª…ì´ í•´ë‹¹ ë¶€ìœ„ ìš´ë™ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì—†ìœ¼ë©´  
        2-1. ìš´ë™ ë“œëë‹¤ìš´ ê´€ë¦¬ì— <b>ìë™ìœ¼ë¡œ ì¶”ê°€</b>ë©ë‹ˆë‹¤.
    </div>
  </div>

  <!-- 4. 4ì¸ ê·¸ë£¹ ìš´ë™í‘œ (A4 ì¸ì‡„ìš©) -->
  <div class="box" id="groupPrintArea">
    <div class="section-title">4. 4ì¸ ê·¸ë£¹ ìš´ë™í‘œ ìƒì„± (ì €ì¥ íšŒì› ê¸°ë°˜ + ë ˆë²¨ í‘œì‹œ + A4 ì¸ì‡„)</div>
    <label>ê·¸ë£¹ìš© íšŒì› ì„ íƒ:
      <select id="groupMemberSelect">
        <option value="">íšŒì› ì„ íƒ</option>
      </select>
    </label>
    <button id="addGroupMemberBtn" class="btn-primary">ê·¸ë£¹ì— ì¶”ê°€</button>
    <span class="small">â€» ì €ì¥ëœ íšŒì›ë§Œ ì„ íƒ ê°€ëŠ¥, ìµœëŒ€ 4ëª…</span>
    <div id="groupMemberTags" style="margin-top:6px;"></div>

    <button id="generateGroupTableBtn" class="btn-purple">ì˜¤ëŠ˜ ë£¨í‹´ìœ¼ë¡œ 4ì¸ ìš´ë™í‘œ ìƒì„±</button>
    <button id="printGroupBtn" class="btn-warning">ê·¸ë£¹ìš´ë™í‘œ ì¸ì‡„(PDF)</button>
    <span class="small">
      â€» ì¸ì‡„ ì‹œ ì´ ì˜ì—­ë§Œ A4 í•œ í˜ì´ì§€ì— ë§ì¶° ì¶œë ¥ë©ë‹ˆë‹¤.<br/>
      â€» ë¸Œë¼ìš°ì € ì¸ì‡„ ì°½ì—ì„œ â€œPDFë¡œ ì €ì¥â€ì„ ì„ íƒí•˜ë©´ PDF íŒŒì¼ë¡œ ì €ì¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.
    </span>

    <table id="groupTable" style="margin-top:10px;">
      <thead id="groupTableHead"></thead>
      <tbody id="groupTableTbody"></tbody>
    </table>
    <span class="small">
      â€» ê° íšŒì› ì´ë¦„ ì˜†ì— [ë ˆë²¨]ì€ ì§€ê¸ˆê¹Œì§€ ì €ì¥ëœ ìš´ë™ íšŸìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìë™ íŒë‹¨ë©ë‹ˆë‹¤.<br/>
      â€» ë¬´ê²Œ ì…ë ¥ì¹¸ì˜ placeholderëŠ” í•´ë‹¹ ìš´ë™ì— ëŒ€í•œ ê³¼ê±° ë¬´ê²Œë¥¼ ì°¸ê³ í•´ì„œ ë³´ì—¬ì¤ë‹ˆë‹¤(ìˆì„ ê²½ìš°).
    </span>
  </div>

  <!-- 5. ì €ì¥ëœ ê¸°ë¡ ì¡°íšŒ + CSV + ë°±ì—…/ë³µêµ¬ -->
  <h2>ì €ì¥ëœ ìš´ë™ ê¸°ë¡ (íšŒì›ë³„ / ì¼ìë³„ ì¡°íšŒ & ì—‘ì…€/ë°±ì—…)</h2>
  <div class="box">
    <div style="margin-bottom:6px;">
      <label>íšŒì› ì„ íƒ:
        <select id="searchMemberSelect">
          <option value="">ì „ì²´ íšŒì›</option>
        </select>
      </label>
      <label>ì‹œì‘ì¼:
        <input type="date" id="dateFrom" />
      </label>
      <label>ì¢…ë£Œì¼:
        <input type="date" id="dateTo" />
      </label>
    </div>
    <button id="filterBtn" class="btn-primary">ê²€ìƒ‰</button>
    <button id="resetFilterBtn" class="btn-gray">í•„í„° ì´ˆê¸°í™”</button>
    <button id="exportCsvBtn" class="btn-warning">ì—‘ì…€(DB)ìš© CSV ë‹¤ìš´ë¡œë“œ</button>
    <br />
    <span class="small">
      â€» CSVëŠ” ì—‘ì…€ì—ì„œ ë°”ë¡œ ì—´ ìˆ˜ ìˆëŠ” í˜•ì‹ì…ë‹ˆë‹¤.<br/>
      â€» êµ¬ì¡°: ë‚ ì§œì‹œê°„, íšŒì›ID, ì´ë¦„, ë¶€ìœ„, ìš´ë™ëª…, ì„¸íŠ¸ë²ˆí˜¸, ë¬´ê²Œ(kg), íšŸìˆ˜(íšŒ)
    </span>
  </div>

  <table>
    <thead>
      <tr>
        <th>ë‚ ì§œ/ì‹œê°„</th>
        <th>íšŒì›</th>
        <th>ìš´ë™ ë£¨í‹´ ìš”ì•½</th>
      </tr>
    </thead>
    <tbody id="sessionsTbody"></tbody>
  </table>

  <!-- 6. ë°±ì—…/ë³µêµ¬ (UIëŠ” ìˆ¨ê¹€, ê¸°ëŠ¥ì€ ìœ ì§€) -->
  <div class="box" style="display:none;">
    <div class="section-title">6. ë°ì´í„° ë°±ì—… / ë³µêµ¬</div>
    <button id="backupJsonBtn" class="btn-primary">JSON ë°±ì—… ë‚´ë³´ë‚´ê¸°</button>
    <label style="margin-left:10px;">
      JSON ë°±ì—… ë¶ˆëŸ¬ì˜¤ê¸°:
      <input type="file" id="restoreJsonInput" accept="application/json" />
    </label>
    <div id="backupInfo" class="small" style="margin-top:6px;">
      ìµœê·¼ ìë™ ë°±ì—…: ì—†ìŒ
    </div>

    <div style="margin-top:6px;">
      <label>
        <input type="checkbox" id="autoDownloadBackupToggle" />
        ì°½ì„ ë‹«ì„ ë•Œ ìë™ìœ¼ë¡œ JSON ë°±ì—… íŒŒì¼ ë‹¤ìš´ë¡œë“œ
      </label>
      <span class="small">â€» PC ë‹¤ìš´ë¡œë“œ í´ë”ì— ë‚ ì§œ/ì‹œê°„ë³„ë¡œ ì €ì¥ë©ë‹ˆë‹¤.</span>
    </div>

    <span class="small">
      â€» â€œJSON ë°±ì—… ë‚´ë³´ë‚´ê¸°â€ëŠ” íŒŒì¼ë¡œ ì €ì¥ë˜ëŠ” ìˆ˜ë™ ë°±ì—…ì…ë‹ˆë‹¤.<br/>
      â€» í”„ë¡œê·¸ë¨ì„ ëŒ ë•Œë§ˆë‹¤ ë‚´ë¶€ ìë™ë°±ì—…ë„ í•¨ê»˜ ê°±ì‹ ë©ë‹ˆë‹¤(ë¸Œë¼ìš°ì € localStorage ê¸°ì¤€).
    </span>
  </div>

  <!-- 7. ì¸ë°”ë”” ê¸°ë¡ ê´€ë¦¬ -->
  <div class="box">
    <div class="section-title">7. ì¸ë°”ë”” ê¸°ë¡ ê´€ë¦¬ (íšŒì›ë³„ ì¸ë°”ë”” ì¶”ì´)</div>
    <div style="margin-bottom:6px;">
      <label>ëŒ€ìƒ íšŒì›:
        <select id="inbodyMemberSelect">
          <option value="">íšŒì› ì„ íƒ</option>
        </select>
      </label>
    </div>
    <div style="margin-bottom:6px;">
      <label>ê¸°ë¡ì¼:
        <input type="date" id="inbodyDate" />
      </label>
      <label>ì²´ì¤‘(kg):
        <input type="number" step="0.1" id="inbodyWeight" />
      </label>
      <label>ê³¨ê²©ê·¼ëŸ‰(kg):
        <input type="number" step="0.1" id="inbodyMuscle" />
      </label>
      <label>ì²´ì§€ë°©ë¥ (%):
        <input type="number" step="0.1" id="inbodyFatPercent" />
      </label>
      <label>ì²´ì§€ë°©ëŸ‰(kg):
        <input type="number" step="0.1" id="inbodyFatMass" />
      </label>
      <label>ë©”ëª¨:
        <input type="text" id="inbodyMemo" placeholder="ì˜ˆ: ì˜¤ì „ ì¸¡ì •, ê³µë³µ ë“±" />
      </label>
      <button id="addInbodyBtn" class="btn-success">ì¸ë°”ë”” ê¸°ë¡ ì¶”ê°€</button>
    </div>
    <div style="margin-bottom:6px;">
      <label>CSV ì—…ë¡œë“œ:
        <input type="file" id="inbodyFileInput" accept=".csv,text/csv" />
      </label>
      <span class="small">
        í˜•ì‹: ë‚ ì§œ,ì²´ì¤‘,ê³¨ê²©ê·¼ëŸ‰,ì²´ì§€ë°©ë¥ ,ì²´ì§€ë°©ëŸ‰<br/>
        ì˜ˆ) 2025-11-28,70.3,32.1,18.5,13.0
      </span>
    </div>
    <table>
      <thead>
        <tr>
          <th>ë‚ ì§œ</th>
          <th>ì²´ì¤‘</th>
          <th>ê³¨ê²©ê·¼ëŸ‰</th>
          <th>ì²´ì§€ë°©ë¥ </th>
          <th>ì²´ì§€ë°©ëŸ‰</th>
          <th>ë©”ëª¨</th>
          <th>ì‚­ì œ</th>
        </tr>
      </thead>
      <tbody id="inbodyTbody"></tbody>
    </table>
    <span class="small">
      â€» ì¸ë°”ë”” ê¸°ê³„ì—ì„œ CSVë¡œ ë½‘ì€ íŒŒì¼ì„ ì´ í˜•ì‹ìœ¼ë¡œ ë§ì¶”ë©´ ì—…ë¡œë“œë¡œ í•œ ë²ˆì— ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br/>
      â€» ì´ë¯¸ì§€(PDF ì¶œë ¥ì§€) ìì²´ë¥¼ ìë™ ì¸ì‹í•˜ëŠ” ê¸°ëŠ¥ì€ ë³„ë„ ì„œë²„/AIê°€ í•„ìš”í•´ì„œ, í˜„ì¬ ë²„ì „ì—ì„œëŠ” ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </span>
  </div>

  <!-- ì „ì²´ íšŒì› ëª¨ë‹¬ -->
  <div id="membersModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <span class="section-title">ì „ì²´ íšŒì› ëª©ë¡</span>
        <button id="closeMembersModalBtn" class="btn-gray">ë‹«ê¸°</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>ì´ë¦„</th>
            <th>ì„±ë³„</th>
            <th>í‚¤</th>
            <th>ìƒë…„ì›”ì¼</th>
            <th>ì „í™”ë²ˆí˜¸</th>
            <th>ì‚­ì œ</th>
          </tr>
        </thead>
        <tbody id="membersTbody"></tbody>
      </table>
    </div>
  </div>

  <script>
    // ====== ìƒìˆ˜ ë° ê¸°ë³¸ê°’ ======
    const STORAGE_SESSIONS_KEY   = "workoutSessions_v4";
    const STORAGE_MEMBERS_KEY    = "members_v2";
    const STORAGE_AUTOBACKUP_KEY = "workoutAutoBackup_v1";
    const STORAGE_AUTO_DL_KEY    = "autoDownloadBackupEnabled_v1";
    const STORAGE_EXLIB_KEY      = "exerciseLibrary_v1";
    const STORAGE_INBODY_KEY     = "inbodyRecords_v1";

    // ê¸°ë³¸ ìš´ë™ ë¼ì´ë¸ŒëŸ¬ë¦¬
    const DEFAULT_EXERCISE_LIBRARY = {
      "ê°€ìŠ´": ["ë²¤ì¹˜í”„ë ˆìŠ¤","ì¸í´ë¼ì¸ ë²¤ì¹˜í”„ë ˆìŠ¤","ë¤ë²¨ ë²¤ì¹˜í”„ë ˆìŠ¤","ë¤ë²¨ í”Œë¼ì´","ì¸í´ë¼ì¸ ë¤ë²¨ í”Œë¼ì´","í™ë± í”Œë¼ì´","ì²´ìŠ¤íŠ¸ í”„ë ˆìŠ¤ ë¨¸ì‹ ","í‘¸ì‹œì—…"],
      "ë“±": ["ë«í’€ë‹¤ìš´","ì‹œí‹°ë“œ ë¡œìš°","ë°”ë²¨ ë¡œìš°","ë¤ë²¨ ë¡œìš°","ì¼€ì´ë¸” ë¡œìš°","í’€ì—…","ì¹œì—…","í‹°ë°” ë¡œìš°"],
      "í•˜ì²´": ["ìŠ¤ì¿¼íŠ¸","ë ˆê·¸í”„ë ˆìŠ¤","ëŸ°ì§€","ë ˆê·¸ ìµìŠ¤í…ì…˜","ë ˆê·¸ ì»¬","ë¶ˆê°€ë¦¬ì•ˆ ìŠ¤í”Œë¦¿ ìŠ¤ì¿¼íŠ¸","íˆí”„ ì“°ëŸ¬ìŠ¤íŠ¸","ìŠ¤í‹°í”„ ë°ë“œë¦¬í”„íŠ¸"],
      "ì–´ê¹¨": ["ìˆ„ë” í”„ë ˆìŠ¤","ë¤ë²¨ ìˆ„ë” í”„ë ˆìŠ¤","ì‚¬ì´ë“œ ë ˆí„°ëŸ´ ë ˆì´ì¦ˆ","í”„ë¡ íŠ¸ ë ˆì´ì¦ˆ","ë¦¬ì–´ ë¸íŠ¸ í”Œë¼ì´","í˜ì´ìŠ¤ í’€","ì—…ë¼ì´íŠ¸ ë¡œìš°"],
      "íŒ”": ["ë°”ë²¨ ì»¬","ë¤ë²¨ ì»¬","í•´ë¨¸ ì»¬","ì¼€ì´ë¸” í‘¸ì‹œë‹¤ìš´","íŠ¸ë¼ì´ì…‰ìŠ¤ ìµìŠ¤í…ì…˜","ë”¥ìŠ¤","ì˜¤ë²„í—¤ë“œ íŠ¸ë¼ì´ì…‰ìŠ¤ ìµìŠ¤í…ì…˜"],
      "ì „ì‹ ": ["ë°ë“œë¦¬í”„íŠ¸","í´ë¦°","ìŠ¤ë‚´ì¹˜","ë²„í”¼","ì¼€í‹€ë²¨ ìŠ¤ìœ™"],
      "ì½”ì–´": ["í”Œë­í¬","í¬ëŸ°ì¹˜","ë ˆê·¸ ë ˆì´ì¦ˆ","í–‰ì‰ ë ˆê·¸ ë ˆì´ì¦ˆ","ì¼€ì´ë¸” í¬ëŸ°ì¹˜","ëŸ¬ì‹œì•ˆ íŠ¸ìœ„ìŠ¤íŠ¸"],
      "ê¸°íƒ€": ["ì›Œí‚¹ ëŸ°ì§€","íŒŒë¨¸ìŠ¤ ì›Œí¬","ìŠ¬ë ˆë“œ í‘¸ì‹œ"]
    };

    let exerciseLibrary = {};

    function loadExerciseLibrary() {
      const raw = localStorage.getItem(STORAGE_EXLIB_KEY);
      if (!raw) {
        exerciseLibrary = JSON.parse(JSON.stringify(DEFAULT_EXERCISE_LIBRARY));
        saveExerciseLibrary();
        return;
      }
      try {
        const parsed = JSON.parse(raw);
        const base = JSON.parse(JSON.stringify(DEFAULT_EXERCISE_LIBRARY));
        exerciseLibrary = { ...base, ...parsed };
        Object.keys(base).forEach(part => {
          if (!Array.isArray(exerciseLibrary[part])) {
            exerciseLibrary[part] = base[part];
          }
        });
      } catch {
        exerciseLibrary = JSON.parse(JSON.stringify(DEFAULT_EXERCISE_LIBRARY));
        saveExerciseLibrary();
      }
    }
    function saveExerciseLibrary() {
      localStorage.setItem(STORAGE_EXLIB_KEY, JSON.stringify(exerciseLibrary));
    }

    // ì´ì „ ë²„ì „ í‚¤ ë§ˆì´ê·¸ë ˆì´ì…˜
    (function migrateOldData() {
      try {
        if (!localStorage.getItem(STORAGE_SESSIONS_KEY)) {
          const oldSessionKeys = ["workoutSessions_v3", "workoutSessions_v2", "workoutSessions_v1"];
          for (const k of oldSessionKeys) {
            const raw = localStorage.getItem(k);
            if (raw) {
              localStorage.setItem(STORAGE_SESSIONS_KEY, raw);
              break;
            }
          }
        }
        if (!localStorage.getItem(STORAGE_MEMBERS_KEY)) {
          const oldMemberKeys = ["members_v1"];
          for (const k of oldMemberKeys) {
            const raw = localStorage.getItem(k);
            if (raw) {
              localStorage.setItem(STORAGE_MEMBERS_KEY, raw);
              break;
            }
          }
        }
      } catch (e) {
        console.error("migration error", e);
      }
    })();

    // ìš´ë™ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ
    loadExerciseLibrary();

    // ====== DOM ì°¸ì¡° ======
    const regNameInput    = document.getElementById("regName");
    const regGenderInput  = document.getElementById("regGender");
    const regHeightInput  = document.getElementById("regHeight");
    const regBirthInput   = document.getElementById("regBirth");
    const regPhoneInput   = document.getElementById("regPhone");
    const registerMemberBtn = document.getElementById("registerMemberBtn");
    const openMembersModalBtn = document.getElementById("openMembersModalBtn");
    const membersModal    = document.getElementById("membersModal");
    const closeMembersModalBtn = document.getElementById("closeMembersModalBtn");
    const membersTbody    = document.getElementById("membersTbody");

    const memberSelect    = document.getElementById("memberSelect");
    const memberSearchInput = document.getElementById("memberSearchInput");
    const memberSearchBtn = document.getElementById("memberSearchBtn");
    const selectedMemberInfo = document.getElementById("selectedMemberInfo");

    const dashboardSummaryDiv = document.getElementById("dashboardSummary");
    const dashboardVolumeDiv  = document.getElementById("dashboardVolume");
    const dashboardInbodyDiv  = document.getElementById("dashboardInbody");

    const bodyPartSelect  = document.getElementById("bodyPart");
    const exerciseNameInput = document.getElementById("exerciseName");
    const exercisePresetSelect = document.getElementById("exercisePreset");
    const lastHintDiv     = document.getElementById("lastHint");
    const currentSetTbody = document.getElementById("currentSetTbody");
    const addSetBtn       = document.getElementById("addSetBtn");
    const resetSetsBtn    = document.getElementById("resetSetsBtn");
    const addExerciseBtn  = document.getElementById("addExerciseBtn");
    const todayTbody      = document.getElementById("todayTbody");
    const saveSessionBtn  = document.getElementById("saveSessionBtn");

    const libBodyPartSelect  = document.getElementById("libBodyPart");
    const libExerciseList    = document.getElementById("libExerciseList");
    const libNewExerciseInput= document.getElementById("libNewExercise");
    const libAddBtn          = document.getElementById("libAddBtn");
    const libDeleteBtn       = document.getElementById("libDeleteBtn");

    const groupMemberSelect = document.getElementById("groupMemberSelect");
    const addGroupMemberBtn = document.getElementById("addGroupMemberBtn");
    const groupMemberTags   = document.getElementById("groupMemberTags");
    const generateGroupTableBtn = document.getElementById("generateGroupTableBtn");
    const printGroupBtn     = document.getElementById("printGroupBtn");
    const groupTableHead    = document.getElementById("groupTableHead");
    const groupTableTbody   = document.getElementById("groupTableTbody");

    const searchMemberSelect = document.getElementById("searchMemberSelect");
    const dateFromInput    = document.getElementById("dateFrom");
    const dateToInput      = document.getElementById("dateTo");
    const filterBtn        = document.getElementById("filterBtn");
    const resetFilterBtn   = document.getElementById("resetFilterBtn");
    const exportCsvBtn     = document.getElementById("exportCsvBtn");
    const sessionsTbody    = document.getElementById("sessionsTbody");

    // 8. í…ìŠ¤íŠ¸ ì¼ê´„ ë“±ë¡ìš©
    const bulkTextInput      = document.getElementById("bulkTextInput");
    const bulkTextApplyBtn   = document.getElementById("bulkTextApplyBtn");
    const bulkTextClearBtn   = document.getElementById("bulkTextClearBtn");

    const backupJsonBtn    = document.getElementById("backupJsonBtn");
    const restoreJsonInput = document.getElementById("restoreJsonInput");
    const backupInfo       = document.getElementById("backupInfo");
    const autoDownloadBackupToggle = document.getElementById("autoDownloadBackupToggle");

    const inbodyMemberSelect = document.getElementById("inbodyMemberSelect");
    const inbodyDateInput    = document.getElementById("inbodyDate");
    const inbodyWeightInput  = document.getElementById("inbodyWeight");
    const inbodyMuscleInput  = document.getElementById("inbodyMuscle");
    const inbodyFatPercentInput = document.getElementById("inbodyFatPercent");
    const inbodyFatMassInput = document.getElementById("inbodyFatMass");
    const inbodyMemoInput    = document.getElementById("inbodyMemo");
    const addInbodyBtn       = document.getElementById("addInbodyBtn");
    const inbodyFileInput    = document.getElementById("inbodyFileInput");
    const inbodyTbody        = document.getElementById("inbodyTbody");

    let todayExercises = [];
    let groupMembers   = [];

    // ====== localStorage í—¬í¼ ======
    function loadSessions() {
      const raw = localStorage.getItem(STORAGE_SESSIONS_KEY);
      if (!raw) return [];
      try { return JSON.parse(raw); } catch { return []; }
    }
    function saveSessions(sessions) {
      localStorage.setItem(STORAGE_SESSIONS_KEY, JSON.stringify(sessions));
    }

    function loadMembers() {
      const raw = localStorage.getItem(STORAGE_MEMBERS_KEY);
      if (!raw) return [];
      try { return JSON.parse(raw); } catch { return []; }
    }
    function saveMembers(members) {
      localStorage.setItem(STORAGE_MEMBERS_KEY, JSON.stringify(members));
    }

    function loadInbody() {
      const raw = localStorage.getItem(STORAGE_INBODY_KEY);
      if (!raw) return [];
      try { return JSON.parse(raw); } catch { return []; }
    }
    function saveInbody(records) {
      localStorage.setItem(STORAGE_INBODY_KEY, JSON.stringify(records));
    }

    // ====== ë°±ì—… ê´€ë ¨ ======
    function createBackupData() {
      return {
        createdAt: Date.now(),
        members: loadMembers(),
        sessions: loadSessions(),
        inbody: loadInbody(),
        exerciseLibrary
      };
    }

    function formatDateTime(ts) {
      const d = new Date(ts);
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,"0");
      const dd = String(d.getDate()).padStart(2,"0");
      const hh = String(d.getHours()).padStart(2,"0");
      const mi = String(d.getMinutes()).padStart(2,"0");
      const ss = String(d.getSeconds()).padStart(2,"0");
      return `${yyyy}-${mm}-${dd} ${hh}:${mi}:${ss}`;
    }

    function updateBackupInfo() {
      if (!backupInfo) return;
      const raw = localStorage.getItem(STORAGE_AUTOBACKUP_KEY);
      if (!raw) {
        backupInfo.textContent = "ìµœê·¼ ìë™ ë°±ì—…: ì—†ìŒ";
        return;
      }
      try {
        const parsed = JSON.parse(raw);
        if (parsed && parsed.time) {
          backupInfo.textContent = `ìµœê·¼ ìë™ ë°±ì—…: ${formatDateTime(parsed.time)} (ë¸Œë¼ìš°ì € ë‚´ë¶€)`;
        } else {
          backupInfo.textContent = "ìµœê·¼ ìë™ ë°±ì—…: ì •ë³´ ì—†ìŒ";
        }
      } catch {
        backupInfo.textContent = "ìµœê·¼ ìë™ ë°±ì—…: ì •ë³´ ì—†ìŒ";
      }
    }

    function saveAutoBackup() {
      try {
        const backup = {
          time: Date.now(),
          data: createBackupData()
        };
        localStorage.setItem(STORAGE_AUTOBACKUP_KEY, JSON.stringify(backup));
        updateBackupInfo();
      } catch (e) {
        console.error("auto backup failed", e);
      }
    }

    function exportJsonBackup() {
      const backup = createBackupData();
      const BOM = "\uFEFF";
      const blob = new Blob([BOM + JSON.stringify(backup, null, 2)], {type:"application/json;charset=utf-8;"});
      const url  = URL.createObjectURL(blob);
      const link = document.createElement("a");
      const now  = new Date();
      const yyyymmdd = `${now.getFullYear()}${String(now.getMonth()+1).padStart(2,"0")}${String(now.getDate()).padStart(2,"0")}`;
      const hh = String(now.getHours()).padStart(2,"0");
      const mi = String(now.getMinutes()).padStart(2,"0");
      link.href = url;
      link.download = `workout_backup_${yyyymmdd}_${hh}${mi}.json`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    function restoreFromJsonFile(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const text = e.target.result;
          const parsed = JSON.parse(text);
          if (!parsed || typeof parsed !== "object") {
            alert("ì˜¬ë°”ë¥¸ JSON ë°±ì—… íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.");
            return;
          }
          const members = Array.isArray(parsed.members) ? parsed.members : [];
          const sessions = Array.isArray(parsed.sessions) ? parsed.sessions : [];
          const inbody = Array.isArray(parsed.inbody) ? parsed.inbody : [];
          const exLib = parsed.exerciseLibrary || null;

          saveMembers(members);
          saveSessions(sessions);
          saveInbody(inbody);
          if (exLib) {
            exerciseLibrary = exLib;
            saveExerciseLibrary();
          } else {
            loadExerciseLibrary();
          }

          saveAutoBackup();
          renderMembersTable();
          renderMemberSelectOptions();
          renderSessions();
          renderInbodyForMember(inbodyMemberSelect.value || memberSelect.value || "");
          renderDashboard();
          alert("ë°±ì—… íŒŒì¼ì—ì„œ ë°ì´í„°ê°€ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
        } catch (err) {
          console.error(err);
          alert("ë°±ì—… íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      };
      reader.readAsText(file, "utf-8");
    }

    function triggerDownloadAutoBackup() {
      const backup = createBackupData();
      const jsonStr = JSON.stringify(backup, null, 2);
      const BOM = "\uFEFF";
      const blob = new Blob([BOM + jsonStr], {
        type: "application/json;charset=utf-8;"
      });

      const now = new Date();
      const yyyy = now.getFullYear();
      const mm   = String(now.getMonth() + 1).padStart(2, "0");
      const dd   = String(now.getDate(), 10).padStart(2, "0");
      const hh   = String(now.getHours(), 10).padStart(2, "0");
      const mi   = String(now.getMinutes(), 10).padStart(2, "0");

      const fileName = `workout_auto_backup_${yyyy}-${mm}-${dd}_${hh}${mi}.json`;

      const url = URL.createObjectURL(blob);
      const a   = document.createElement("a");
      a.href = url;
      a.download = fileName;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function loadAutoDownloadSetting() {
      try {
        const raw = localStorage.getItem(STORAGE_AUTO_DL_KEY);
        if (!raw) return false;
        return raw === "1";
      } catch {
        return false;
      }
    }
    function saveAutoDownloadSetting(enabled) {
      try {
        localStorage.setItem(STORAGE_AUTO_DL_KEY, enabled ? "1" : "0");
      } catch (e) {
        console.error("failed to save autoDownload setting", e);
      }
    }
    function initAutoDownloadToggle() {
      if (!autoDownloadBackupToggle) return;
      const enabled = loadAutoDownloadSetting();
      autoDownloadBackupToggle.checked = enabled;
      autoDownloadBackupToggle.addEventListener("change", () => {
        saveAutoDownloadSetting(autoDownloadBackupToggle.checked);
      });
    }

    if (backupJsonBtn) {
      backupJsonBtn.addEventListener("click", exportJsonBackup);
    }
    if (restoreJsonInput) {
      restoreJsonInput.addEventListener("change", () => {
        const file = restoreJsonInput.files[0];
        if (!file) return;
        if (!confirm("ì„ íƒí•œ ë°±ì—… íŒŒì¼ë¡œ í˜„ì¬ ë°ì´í„°ë¥¼ ë®ì–´ì“¸ê¹Œìš”?")) {
          restoreJsonInput.value = "";
          return;
        }
        restoreFromJsonFile(file);
        restoreJsonInput.value = "";
      });
    }

    // ì°½ ë‹«ì„ ë•Œ: ë‚´ë¶€ ìë™ë°±ì—… + í† ê¸€ ONì´ë©´ íŒŒì¼ ìë™ ë‹¤ìš´ë¡œë“œ
    window.addEventListener("beforeunload", (e) => {
      saveAutoBackup();
      const enabled = loadAutoDownloadSetting();
      if (enabled) {
        try {
          triggerDownloadAutoBackup();
        } catch (err) {
          console.error("auto download backup failed", err);
        }
      }
      e.preventDefault();
      e.returnValue = "";
    });

    // ====== íšŒì› ê´€ë¦¬ ======
    function registerMember() {
      const name   = regNameInput.value.trim();
      const gender = regGenderInput.value;
      const height = regHeightInput.value.trim();
      const birth  = regBirthInput.value;
      const phone  = regPhoneInput.value.trim();

      if (!name) {
        alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      const members = loadMembers();
      const newMember = {
        id: Date.now(),
        name,
        gender,
        height: height ? Number(height) : null,
        birth,
        phone,
        createdAt: Date.now(),
      };
      members.push(newMember);
      saveMembers(members);
      saveAutoBackup();

      regNameInput.value = "";
      regGenderInput.value = "";
      regHeightInput.value = "";
      regBirthInput.value = "";
      regPhoneInput.value = "";

      renderMembersTable();
      renderMemberSelectOptions();
      alert("íšŒì›ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    function deleteMember(id) {
      if (!confirm("ì •ë§ ì´ íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nâ€» ìš´ë™ ê¸°ë¡/ì¸ë°”ë”” ë°ì´í„°ëŠ” ë‚¨ì•„ ìˆì§€ë§Œ, íšŒì› ëª©ë¡ì—ì„œëŠ” ì œê±°ë©ë‹ˆë‹¤.")) return;
      let members = loadMembers();
      members = members.filter(m => String(m.id) !== String(id));
      saveMembers(members);
      saveAutoBackup();

      if (memberSelect.value === String(id)) {
        memberSelect.value = "";
        todayExercises = [];
        renderTodayExercises();
      }
      if (searchMemberSelect.value === String(id)) {
        searchMemberSelect.value = "";
      }
      if (groupMembers.includes(String(id))) {
        groupMembers = groupMembers.filter(mid => mid !== String(id));
        renderGroupMembers();
      }
      if (inbodyMemberSelect.value === String(id)) {
        inbodyMemberSelect.value = "";
        renderInbodyForMember("");
      }

      renderMembersTable();
      renderMemberSelectOptions();
      renderSessions();
      renderDashboard();
    }

    function renderMembersTable() {
      const members = loadMembers().slice().sort((a, b) => a.name.localeCompare(b.name, "ko"));
      membersTbody.innerHTML = "";
      members.forEach(m => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${m.name}</td>
          <td>${m.gender || "-"}</td>
          <td>${m.height ? m.height + "cm" : "-"}</td>
          <td>${m.birth || "-"}</td>
          <td>${m.phone || "-"}</td>
          <td><button type="button" class="btn-danger deleteMemberBtn" data-id="${m.id}">ì‚­ì œ</button></td>
        `;
        membersTbody.appendChild(tr);
      });

      membersTbody.querySelectorAll(".deleteMemberBtn").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-id");
          deleteMember(id);
        });
      });
    }

    function updateInbodyMemberSelectOptions() {
      const members = loadMembers().slice().sort((a, b) => a.name.localeCompare(b.name, "ko"));
      const current = inbodyMemberSelect.value;
      inbodyMemberSelect.innerHTML = `<option value="">íšŒì› ì„ íƒ</option>`;
      members.forEach(m => {
        const option = document.createElement("option");
        option.value = String(m.id);
        option.textContent = `${m.name} (${m.phone || "ì „í™”ë²ˆí˜¸ ì—†ìŒ"})`;
        inbodyMemberSelect.appendChild(option);
      });
      if (current) inbodyMemberSelect.value = current;
    }

    function renderMemberSelectOptions() {
      const members = loadMembers().slice().sort((a, b) => a.name.localeCompare(b.name, "ko"));

      const currentValue = memberSelect.value;
      memberSelect.innerHTML = `<option value="">íšŒì› ì„ íƒ</option>`;
      members.forEach(m => {
        const option = document.createElement("option");
        option.value = String(m.id);
        option.textContent = `${m.name} (${m.phone || "ì „í™”ë²ˆí˜¸ ì—†ìŒ"})`;
        memberSelect.appendChild(option);
      });
      if (currentValue) memberSelect.value = currentValue;

      const searchCurrent = searchMemberSelect.value;
      searchMemberSelect.innerHTML = `<option value="">ì „ì²´ íšŒì›</option>`;
      members.forEach(m => {
        const option = document.createElement("option");
        option.value = String(m.id);
        option.textContent = `${m.name} (${m.phone || "ì „í™”ë²ˆí˜¸ ì—†ìŒ"})`;
        searchMemberSelect.appendChild(option);
      });
      if (searchCurrent) searchMemberSelect.value = searchCurrent;

      const groupCurrent = groupMemberSelect.value;
      groupMemberSelect.innerHTML = `<option value="">íšŒì› ì„ íƒ</option>`;
      members.forEach(m => {
        const option = document.createElement("option");
        option.value = String(m.id);
        option.textContent = `${m.name} (${m.phone || "ì „í™”ë²ˆí˜¸ ì—†ìŒ"})`;
        groupMemberSelect.appendChild(option);
      });
      if (groupCurrent) groupMemberSelect.value = groupCurrent;

      updateInbodyMemberSelectOptions();
      updateSelectedMemberInfo();
      renderGroupMembers();
    }

    function findMemberById(id) {
      const members = loadMembers();
      return members.find(m => String(m.id) === String(id)) || null;
    }

    function updateSelectedMemberInfo() {
      const memberId = memberSelect.value;
      if (!memberId) {
        selectedMemberInfo.textContent = "ì„ íƒëœ íšŒì› ì •ë³´: ì—†ìŒ";
        dashboardSummaryDiv.textContent = "1ë²ˆì—ì„œ íšŒì›ì„ ì„ íƒí•˜ë©´, ìš´ë™ëŸ‰/ê¸°ë¡/ì¸ë°”ë”” ì¶”ì´ë¥¼ í•œëˆˆì— ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
        dashboardVolumeDiv.innerHTML = "";
        dashboardInbodyDiv.innerHTML = "";
        return;
      }
      const m = findMemberById(memberId);
      if (!m) {
        selectedMemberInfo.textContent = "ì„ íƒëœ íšŒì› ì •ë³´: (ì‚­ì œëœ íšŒì›)";
        return;
      }
      selectedMemberInfo.innerHTML =
        `ì„ íƒëœ íšŒì› ì •ë³´: <span class="member-tag-mini">${m.name}</span>` +
        `ì„±ë³„: ${m.gender || "-"} / í‚¤: ${m.height ? m.height + "cm" : "-"} / ` +
        `ìƒë…„ì›”ì¼: ${m.birth || "-"} / ì „í™”ë²ˆí˜¸: ${m.phone || "-"}`;

      if (!inbodyMemberSelect.value) {
        inbodyMemberSelect.value = String(memberId);
      }
    }

    registerMemberBtn.addEventListener("click", registerMember);

    openMembersModalBtn.addEventListener("click", () => {
      renderMembersTable();
      membersModal.style.display = "flex";
    });
    closeMembersModalBtn.addEventListener("click", () => {
      membersModal.style.display = "none";
    });

    memberSearchBtn.addEventListener("click", () => {
      const q = memberSearchInput.value.trim();
      if (!q) {
        alert("ê²€ìƒ‰í•  ì´ë¦„ ë˜ëŠ” ì „í™”ë²ˆí˜¸ ì¼ë¶€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
      const members = loadMembers();
      const found = members.find(m =>
        (m.name && m.name.includes(q)) ||
        (m.phone && m.phone.includes(q))
      );
      if (!found) {
        alert("ì¼ì¹˜í•˜ëŠ” íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }
      memberSelect.value = String(found.id);
      memberSelect.dispatchEvent(new Event("change"));
    });

    memberSelect.addEventListener("change", () => {
      updateSelectedMemberInfo();
      todayExercises = [];
      renderTodayExercises();
      bodyPartSelect.value = "";
      exerciseNameInput.value = "";
      lastHintDiv.textContent = "";
      resetSets();
      populateExercisePreset();
      renderDashboard();
      if (inbodyMemberSelect.value === "") {
        inbodyMemberSelect.value = memberSelect.value;
        renderInbodyForMember(memberSelect.value);
      }
    });

    // ====== ì„¸íŠ¸ í–‰ ê´€ë ¨ ======
    function createSetRow(weight = "", reps = "") {
      const row = document.createElement("tr");
      row.className = "set-row";
      const index = currentSetTbody.children.length + 1;
      row.innerHTML = `
        <td class="set-index">${index}ì„¸íŠ¸</td>
        <td><input type="number" min="0" step="0.5" class="set-weight" value="${weight}" /></td>
        <td><input type="number" min="0" step="1" class="set-reps" value="${reps}" /></td>
        <td><button type="button" class="btn-danger deleteSetBtn">X</button></td>
      `;
      const delBtn = row.querySelector(".deleteSetBtn");
      delBtn.addEventListener("click", () => {
        row.remove();
        refreshSetIndex();
      });
      return row;
    }

    function addSetRow(weight = "", reps = "") {
      const row = createSetRow(weight, reps);
      currentSetTbody.appendChild(row);
    }

    function refreshSetIndex() {
      Array.from(currentSetTbody.children).forEach((row, idx) => {
        const idxCell = row.querySelector(".set-index");
        if (idxCell) idxCell.textContent = (idx + 1) + "ì„¸íŠ¸";
      });
    }

    function resetSets(defaultCount = 3) {
      currentSetTbody.innerHTML = "";
      for (let i = 0; i < defaultCount; i++) {
        addSetRow();
      }
    }

    addSetBtn.addEventListener("click", () => {
      addSetRow();
    });

    resetSetsBtn.addEventListener("click", () => {
      resetSets();
      lastHintDiv.textContent = "";
    });

    resetSets();

    // ====== ìš´ë™ ë“œëë‹¤ìš´ ======...
    // (âš ï¸ ë‚˜ë¨¸ì§€ JS ë¡œì§: ìš´ë™ ë“œëë‹¤ìš´, ì˜¤ëŠ˜ ë£¨í‹´, ê·¸ë£¹í‘œ, ì¸ë°”ë””, ëŒ€ì‹œë³´ë“œ ë“±ì€
    // ëŒ€ì¥ë‹˜ì´ ì˜¬ë¦° ì½”ë“œ ê·¸ëŒ€ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤. ì—¬ê¸°ì„œë¶€í„° ëê¹Œì§€ ë™ì¼í•˜ê²Œ ë‘ê³ ,
    // ë§ˆì§€ë§‰ì— AI ì±—ë´‡ ë¶€ë¶„ë§Œ êµì²´í–ˆìŠµë‹ˆë‹¤.)

    // --- ì¤‘ëµ (ìœ„ì—ì„œ ì˜¬ë ¤ì£¼ì‹  ë‚˜ë¨¸ì§€ JS ê·¸ëŒ€ë¡œ) ---
  </script>

  <!-- ğŸ”¥ AI ì±—ë´‡ UI (ìš°ì¸¡ í•˜ë‹¨, ì‚¬ì´ì¦ˆ ì—…ê·¸ë ˆì´ë“œ ë²„ì „) -->
  <style>
  #aiChatButton {
    position: fixed;
    bottom: 24px;
    right: 24px;
    background: #2563eb;
    border-radius: 50%;
    width: 58px;
    height: 58px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 26px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.28);
    z-index: 999;
  }
  #aiChatWindow {
    position: fixed;
    bottom: 96px;
    right: 24px;
    width: 470px;      /* ğŸ‘‰ A+1: ì¡°ê¸ˆ ë” í° ì°½ */
    max-height: 650px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.32);
    display: none;
    flex-direction: column;
    overflow: hidden;
    z-index: 9999;
  }
  #aiChatHeader {
    padding: 12px;
    background: #1e3a8a;
    color: white;
    font-size: 15px;
    font-weight: 600;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  #aiChatMessages {
    padding: 12px;
    flex: 1;
    overflow-y: auto;
    font-size: 14px;
  }
  .aiMsg {
    margin-bottom: 12px;
    line-height: 1.4;
  }
  .aiMe { text-align: right; color: #2563eb; font-weight: 600; }
  .aiBot { text-align: left; }
  #aiChatInputArea {
    display: flex;
    border-top: 1px solid #ddd;
  }
  #aiChatInput {
    flex: 1;
    resize: none;
    padding: 8px;
    border: none;
    font-size: 14px;
    outline: none;
  }
  #aiChatSend {
    width: 70px;
    background: #2563eb;
    border: none;
    color: white;
    cursor: pointer;
    font-weight: 600;
  }
  </style>

  <div id="aiChatButton">ğŸ’¬</div>

  <div id="aiChatWindow">
    <div id="aiChatHeader">
      AI ìš´ë™ ë¶„ì„ ì±—ë´‡
      <span id="aiChatClose" style="cursor:pointer;">âœ–</span>
    </div>
    <div id="aiChatMessages"></div>
    <div id="aiChatInputArea">
      <textarea id="aiChatInput" rows="1" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥..."></textarea>
      <button id="aiChatSend">ì „ì†¡</button>
    </div>
  </div>

  <script>
    // ====== ì—´ê¸° / ë‹«ê¸° ======
    document.getElementById("aiChatButton").onclick = () => {
      document.getElementById("aiChatWindow").style.display = "flex";
    };
    document.getElementById("aiChatClose").onclick = () => {
      document.getElementById("aiChatWindow").style.display = "none";
    };

    // ====== ë§í’ì„  ì¶œë ¥ ======
    function aiAddMessage(text, sender = "bot") {
      const box = document.getElementById("aiChatMessages");
      const div = document.createElement("div");
      div.className = "aiMsg " + (sender === "me" ? "aiMe" : "aiBot");
      div.innerHTML = text;
      box.appendChild(div);
      box.scrollTop = box.scrollHeight;
    }

    // ====== Netlify Functionsë¡œ ìš”ì²­ ë³´ë‚´ê¸° ======
    async function aiSendToServer(msg) {
      try {
        const memberId = window.memberSelect?.value || "";
        const payload = {
          message: msg,
          memberId,
          members: loadMembers(),
          sessions: loadSessions(),
          inbody: loadInbody(),
          exerciseLibrary
        };

        const res = await fetch("https://plain-dew-cd06.ownwind1.workers.dev/ai-chat", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(payload)
});


        if (!res.ok) {
          aiAddMessage(`âš  ì„œë²„ ì˜¤ë¥˜ (status: ${res.status})`, "bot");
          return;
        }

        const data = await res.json();
        console.log("AI ì‘ë‹µ:", data);

        const replyText =
          data.text ||
          data.reply ||
          data.message ||
          "";

        if (replyText) {
          aiAddMessage(replyText, "bot");
        } else {
          aiAddMessage("âš  ì„œë²„ ì‘ë‹µì€ ë°›ì•˜ì§€ë§Œ, í‘œì‹œí•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.", "bot");
        }

        if (data.action) {
          handleAiAction(data.action);
        }

      } catch (e) {
        console.error(e);
        aiAddMessage("âš ï¸ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (Netlify Functions ì„¤ì • í™•ì¸ í•„ìš”)", "bot");
      }
    }

    // ====== AIê°€ ë‚´ë ¤ì¤€ action ì²˜ë¦¬ ======
    function handleAiAction(action) {
      if (action.addExercises && Array.isArray(action.addExercises)) {
        if (!Array.isArray(window.todayExercises)) {
          window.todayExercises = [];
        }
        window.todayExercises = window.todayExercises.concat(action.addExercises);
        if (typeof renderTodayExercises === "function") {
          renderTodayExercises();
        }
      }

      if (action.inbodyAnalysis && typeof action.inbodyAnalysis === "string") {
        const dash = document.getElementById("dashboardInbody");
        if (dash) {
          dash.innerHTML += `
            <div class="dashboard-card" style="margin-top:6px;">
              <strong>AI ë¶„ì„ ê²°ê³¼</strong><br/>${action.inbodyAnalysis}
            </div>`;
        }
      }

      if (action.alert) {
        alert(action.alert);
      }
    }

    // ====== ë©”ì‹œì§€ ì „ì†¡ ê³µí†µ ë¡œì§ ======
    function sendMessage() {
      const input = document.getElementById("aiChatInput");
      const msg = input.value.trim();
      if (!msg) return;
      aiAddMessage(msg, "me");
      input.value = "";
      aiSendToServer(msg);
    }

    document.getElementById("aiChatSend").onclick = sendMessage;

    document.getElementById("aiChatInput").addEventListener("keydown", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
  </script>
</body>
</html>
